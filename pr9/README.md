# Практична робота №8
## Завдання №1
Напишіть програму, яка читає файл /etc/passwd за допомогою команди getent passwd, щоб дізнатись, які облікові записи визначені на вашому комп’ютері. Програма повинна визначити, чи є серед них звичайні користувачі (ідентифікатори UID повинні бути більші за 500 або 1000, залежно від вашого дистрибутива), окрім вас.
## Реалізація завдання
Було написано програму, яка перевіряє облікові записи користувачів у системі через команду `getent passwd`, і визначає серед них звичайних користувачів з UID, більшим за заданий поріг, окрім поточного користувача.
+ **Виклик команди `getent passwd`**. Використовується функція `popen()` для отримання результатів команди, яка повертає список всіх облікових записів із `/etc/passwd`.
+ **Отримання UID поточного користувача**. `getuid()` визначає UID процесу, щоб порівнювати з іншими записами.
+ **Обробка результатів команди**. `fgets()` читає строки виводу `getent passwd`. Функція `strtok()` розбиває кожен рядок за роздільником `:`, витягуючи ім'я користувача і UID.
+ **Перевірка UID та вивід інформації**. UID порівнюється з порогом `UID_THRESHOLD` (1000 або 500). Користувачі з UID більше за поріг і не рівні UID поточного процесу відображаються як "звичайні користувачі".
+ **Вивід результатів**. Якщо знайдено хоча б одного користувача, виводиться його ім'я та UID. Якщо таких немає, програма повідомляє про їх відсутність.

## Результат роботи:
![](images/1.png)

## Завдання №2
Напишіть програму, яка виконує команду cat /etc/shadow від імені адміністратора, хоча запускається від звичайного користувача. (Ваша програма повинна робити необхідне, виходячи з того, що конфігурація системи дозволяє отримувати адміністративний доступ за допомогою відповідної команди.)
## Реалізація завдання
Спочатку було використано `printf()` для інформування користувача про виконання команди. Після чого використано `execlp()` для виконання команди `sudo cat /etc/master.passwd`. Ця функція запускає новий процес, заміняючи поточний і виконує команду. Якщо команда `execlp()` не виконується успішно, виводиться повідомлення про помилку через `perror()`.

## Результат роботи:
![](images/2.png)


## Завдання №3
Напишіть програму, яка від імені root копіює файл, який вона перед цим створила від імені звичайного користувача. Потім вона повинна помістити копію у домашній каталог звичайного користувача. Далі, використовуючи звичайний обліковий запис, програма намагається змінити файл і зберегти зміни. Що відбудеться? Після цього програма намагається видалити цей файл за допомогою команди rm. Що відбудеться?
## Реалізація завдання
Було написано програму, яка створює файл `/tmp/user_file.txt` як звичайний користувач із початковим вмістом "Initial content". Права доступу до файлу встановлюються на `0644` (читання для всіх, запис тільки для власника). Далі файл копіюється до домашнього каталогу звичайного користувача `/home/guest/copied_file.txt`. Після копіювання права власності змінюються на `root:wheel`, а права доступу встановлюються на `600` (повний доступ тільки для root). При спробі відкриття файлу для запису звичайним користувачем (з опцією `O_WRONLY`) виникає помилка доступу через недостатні права (оскільки файл належить root і недоступний для модифікації іншими користувачами). При спробі видалення файлу звичайним користувачем виникає помилка доступу. Це відбувається тому, що файл належить root, а права доступу не дозволяють звичайному користувачеві виконувати операції видалення (але оскільки було запущено ОС під `root`, то зазначені вище команди були виконані успішно).
## Результат роботи:
![](images/3.png)


## Завдання №4
Напишіть програму, яка по черзі виконує команди whoami та id, щоб перевірити стан облікового запису користувача, від імені якого вона запущена. Є ймовірність, що команда id виведе список різних груп, до яких ви належите. Програма повинна це продемонструвати.
## Реалізація завдання
Було написано програму, яка запускає команду `whoami`, яка виводить ім'я поточного користувача системи. Це допомагає визначити обліковий запис, від імені якого виконуються операції. Якщо команда не виконується, відображається повідомлення про помилку через `perror`. Далі програма виконує команду `id`, яка виводить UID (ідентифікатор користувача), GID (ідентифікатор групи) і список груп, до яких належить користувач. Якщо є кілька груп, результат команди демонструє належність до них. Результати виконання кожної команди відображаються у консолі, що дозволяє побачити стан облікового запису користувача та його групи.
## Результат роботи:
![](images/4.png)


## Завдання №5
Напишіть програму, яка створює тимчасовий файл від імені звичайного користувача. Потім від імені суперкористувача використовує команди chown і chmod, щоб змінити тип володіння та права доступу. Програма повинна визначити, в яких випадках вона може виконувати читання та запис файлу, використовуючи свій обліковий запис.
## Реалізація завдання
Було написано програму, яка створює тимчасовий файл `/tmp/temp_access_test.txt` зі стандартними правами доступу `0644` (читання для всіх, запис тільки для власника). Файл заповнюється початковим вмістом "Test content". За допомогою команд `sudo chown` та `sudo chmod` змінюється власник файлу (`root:wheel`) та встановлюються права доступу `600` (читання і запис доступні тільки для root). Функція `check_access()` перевіряє права на читання (`R_OK`) та запис (`W_OK`) для поточного користувача. Відповідні повідомлення виводяться в консоль. Програма намагається прочитати вміст файлу. Якщо доступ заборонений, відображається повідомлення про помилку. Аналогічно здійснюється спроба запису до файлу, з повідомленням про успіх чи невдачу.
## Результат роботи:
![](images/5.png)


## Завдання №6
Напишіть програму, яка виконує команду ls -l, щоб переглянути власника і права доступу до файлів у своєму домашньому каталозі, в /usr/bin та в /etc. Продемонструйте, як ваша програма намагається обійти різні власники та права доступу користувачів, а також здійснює спроби читання, запису та виконання цих файлів.
## Реалізація завдання
Було написано програму, яка виконує команду `ls -l` для домашнього каталогу (`$HOME`), `/usr/bin`, і `/etc`, щоб отримати список файлів, їхніх власників і права доступу. Команда `system()` використовується для виконання цієї операції. У кожному каталозі програма проходить по списку файлів за допомогою `readdir()` та перевіряє доступність кожного файлу для читання (`R_OK`), запису (`W_OK`) і виконання (`X_OK`) за допомогою функції `access()`. Відповідні повідомлення виводяться в консоль, залежно від результату перевірки. Якщо файл у каталозі `/usr/bin` є виконуваним (`X_OK`), виводиться повідомлення про спробу виконання (реальне виконання не здійснюється, щоб програма не завершилася під час виконання). Програма демонструє, які файли доступні для читання, запису та виконання залежно від їхніх власників і встановлених прав доступу.
## Результат роботи:
![](images/6.png)


## ЗАВДАННЯ ПО ВАРІАНТАХ (15 ВАРІАНТ):
Напишіть скрипт, що веде логування команд користувача. Як приховати його від ps?
## Реалізація завдання

## Результат роботи:
![](images/7.png)
